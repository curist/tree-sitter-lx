#!/bin/usr/env lx
// ^ preproc

let mod = import "this"
//^ keyword
//  ^ variable
//      ^ operator
//           ^ include
let src = Lx.readTextFile("./examples/io.lox")
//                         ^ string
print(src)
// ^ function

let prompt = fn() {Lx.prompt(">")}
//           ^ keyword.function
for let line = prompt(); line {
//^ repeat
  print(line)
  if true { break }
  for false { continue }
  if nil {
    break 123 // break can optionally take a value
  }
  return x
  // ^ keyword
}

let x = if true {
  let x = 1 + 2 * 3
} else .{ akey: 1 }
//         ^ field

fn myfn(a, b, c) {
// ^ function
//         ^ parameter
}
let adder = fn(a) {
  fn (b) { a + b }
}
let add5 = adder(5)
print(add5(37))

let nnn = nil
//        ^ constant.builtin
let x = a != b and foo

for true and false {
//  ^ boolean ^ boolean
//        ^ keyword.operator
  kkthx = 10
}

for x in [1, 2, 3] {
//^ repeat
//  ^ variable
//    ^ keyword
  print(x)
//^ function
}
for item, idx in items {
//^ repeat
//  ^ variable
//        ^ variable
//            ^ keyword
//               ^ variable
  print(item, idx)
}
for _, i in data {
//     ^ variable
//       ^ keyword
  count = count + 1
}

let doubled = collect x in [1, 2, 3] {
//^ keyword
//  ^ variable
//              ^ repeat
//                    ^ variable
//                      ^ keyword
  x * 2
//^ variable
}

let mymod = {
  .x: 1 -2 + -1,
  .foo: -a,
  .add: fn(a, b) {
    a + b
  },
  [1 + 2]: 3,
  [nnn]: "nil",
}

let Color = enum { Red, Green = 3, Blue }
//^ keyword
//  ^ constant
//        ^ operator
//          ^ keyword
//                 ^ constant
//                      ^ constant
//                                  ^ constant

let Status = enum {
//^ keyword
//  ^ constant
//         ^ operator
//           ^ keyword
  Pending,
//^ constant
  Active = 1,
//^ constant
  Done
//^ constant
}

// Record literal shorthand fields
let name = "test"
let debug = true
let config = .{ name, debug }
//^ keyword
//  ^ variable
//         ^ operator
//              ^ field
//                    ^ field

let point = .{ x, y, z: 0 }
//             ^ field
//                ^ field
//                   ^ field

let mixed = .{ a, b: c, ["key"]: value }
//             ^ field
//                ^ field

// Let record destructuring
let .{ OP, NODE } = import "src/types.lx"
//^ keyword
//     ^ constant
//         ^ constant
//                ^ operator
//                  ^ include

let .{ name: userName, debug } = config
//^ keyword
//     ^ field
//           ^ variable
//                     ^ variable

let .{ x, y, z } = point
//^ keyword
//     ^ variable
//        ^ variable
//           ^ variable

let empty = ""
//          ^ string

let url = "http://foo.bar"
//               ^ string

// Arrow functions
let double = x => x * 2
//^ keyword
//  ^ variable
//         ^ operator
//           ^ parameter
//              ^ operator
//                ^ variable

let add = (a, b) => a + b
//^ keyword
//  ^ variable
//      ^ operator
//         ^ parameter
//            ^ parameter
//                ^ operator

let withDefault = (x = 1) => x
//                 ^ parameter
//                   ^ operator
//                        ^ operator

let blockBody = x => { x + 1 }
//              ^ parameter
//                ^ operator

let nested = x => y => { x + y }
//           ^ parameter
//             ^ operator
//                ^ parameter
//                  ^ operator
